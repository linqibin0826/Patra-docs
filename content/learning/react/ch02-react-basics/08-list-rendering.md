---
title: åˆ—è¡¨æ¸²æŸ“ä¸ key
chapter: 02
section: 08
status: å·²å®Œæˆ
progress:
  started_at: 2025-12-06
  completed_at: 2025-12-06
  time_spent: "1h"
  mastery: ç†Ÿæ‚‰
tags:
  - learning/react/ch02
  - tech/react
  - tech/jsx
---

# åˆ—è¡¨æ¸²æŸ“ä¸ key

> ç”¨ `map` å°†æ•°æ®è½¬æ¢ä¸º UIï¼Œç”¨ `key` å‘Šè¯‰ React "è¿™æ˜¯è°"ã€‚

---

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

- [x] æŒæ¡ç”¨ `map` æ¸²æŸ“åˆ—è¡¨çš„åŸºæœ¬æ¨¡å¼
- [x] ç†è§£ key çš„ä½œç”¨ï¼ˆèº«ä»½æ ‡è¯†ï¼Œä¸æ˜¯ä½ç½®ï¼‰
- [x] æŒæ¡ key çš„é€‰æ‹©åŸåˆ™
- [x] é¿å¼€ index ä½œä¸º key çš„é™·é˜±
- [x] ç†è§£å—æ§ç»„ä»¶çš„ checked + onChange æ¨¡å¼

---

## ğŸ“– çŸ¥è¯†ç‚¹

### 1. ç”¨ map æ¸²æŸ“åˆ—è¡¨ â­

è¿˜è®°å¾—ç¬¬ 1 ç« å­¦çš„ `map` å—ï¼Ÿå®ƒåœ¨ React ä¸­çš„ç”¨æ³•ä¸€æ¨¡ä¸€æ ·ï¼š

```tsx
const products = [
  { id: 1, name: 'iPhone', price: 999 },
  { id: 2, name: 'MacBook', price: 1999 },
];

function ProductList() {
  return (
    <ul>
      {products.map(product => (
        <li key={product.id}>
          {product.name} - ${product.price}
        </li>
      ))}
    </ul>
  );
}
```

**åŸç†**ï¼š`map` è¿”å›ä¸€ä¸ª JSX æ•°ç»„ï¼ŒReact è‡ªåŠ¨å°†æ•°ç»„å±•å¼€æ¸²æŸ“ã€‚

```mermaid
flowchart LR
    subgraph æ•°æ®["ğŸ“¦ æ•°æ®æ•°ç»„"]
        A1["{id:1, name:'iPhone'}"]
        A2["{id:2, name:'MacBook'}"]
    end

    subgraph è½¬æ¢["ğŸ”„ map è½¬æ¢"]
        B["product => &lt;li&gt;...&lt;/li&gt;"]
    end

    subgraph ç»“æœ["ğŸ–¥ï¸ JSX æ•°ç»„"]
        C1["&lt;li&gt;iPhone&lt;/li&gt;"]
        C2["&lt;li&gt;MacBook&lt;/li&gt;"]
    end

    A1 --> B
    A2 --> B
    B --> C1
    B --> C2

    style æ•°æ® fill:#e3f2fd,stroke:#1976d2
    style è½¬æ¢ fill:#fff3e0,stroke:#f57c00
    style ç»“æœ fill:#e8f5e9,stroke:#388e3c
```

---

### 2. ä¸ºä»€ä¹ˆéœ€è¦ keyï¼Ÿ â­â­

æ²¡æœ‰ key æ—¶ï¼Œæ§åˆ¶å°ä¼šæŠ¥è­¦å‘Šï¼š

> Each child in a list should have a unique "key" prop.

**æ ¸å¿ƒé—®é¢˜**ï¼šå½“åˆ—è¡¨å˜åŒ–æ—¶ï¼ŒReact æ€ä¹ˆçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

```
åŸåˆ—è¡¨:  iPhone, MacBook, AirPods
æ–°åˆ—è¡¨:  iPad, iPhone, MacBook, AirPods  â† åœ¨å¼€å¤´æ’å…¥äº† iPad
```

#### âŒ æ²¡æœ‰ keyï¼ˆæŒ‰ä½ç½®å¯¹æ¯”ï¼‰

```mermaid
flowchart LR
    N1["ä½ç½®0: iPhoneâ†’iPad"] -->|æ›´æ–°| N1R["æ›´æ–° DOM"]
    N2["ä½ç½®1: MacBookâ†’iPhone"] -->|æ›´æ–°| N2R["æ›´æ–° DOM"]
    N3["ä½ç½®2: AirPodsâ†’MacBook"] -->|æ›´æ–°| N3R["æ›´æ–° DOM"]
    N4["ä½ç½®3: æ— â†’AirPods"] -->|æ–°å¢| N4R["åˆ›å»º DOM"]

    style N1R fill:#ffebee,stroke:#c62828
    style N2R fill:#ffebee,stroke:#c62828
    style N3R fill:#ffebee,stroke:#c62828
    style N4R fill:#ffebee,stroke:#c62828
```

ç»“æœï¼š**4 æ¬¡ DOM æ“ä½œ**ï¼Œæ•ˆç‡ä½ï¼

#### âœ… æœ‰ keyï¼ˆæŒ‰èº«ä»½å¯¹æ¯”ï¼‰

```mermaid
flowchart LR
    K1["key=4 iPad"] -->|æ–°çš„| K1R["åˆ›å»º DOM"]
    K2["key=1 iPhone"] -->|ä½ç½®å˜äº†| K2R["ç§»åŠ¨"]
    K3["key=2 MacBook"] -->|ä½ç½®å˜äº†| K3R["ç§»åŠ¨"]
    K4["key=3 AirPods"] -->|ä½ç½®å˜äº†| K4R["ç§»åŠ¨"]

    style K1R fill:#e8f5e9,stroke:#388e3c
    style K2R fill:#e3f2fd,stroke:#1976d2
    style K3R fill:#e3f2fd,stroke:#1976d2
    style K4R fill:#e3f2fd,stroke:#1976d2
```

ç»“æœï¼š**1 æ¬¡åˆ›å»º + ç§»åŠ¨**ï¼Œæ•ˆç‡é«˜ï¼

| æ–¹å¼ | DOM æ“ä½œ | æ•ˆç‡ |
|------|----------|------|
| æ²¡æœ‰ key | 4 æ¬¡æ›´æ–°/åˆ›å»º | âŒ ä½ |
| æœ‰ key | 1 æ¬¡åˆ›å»º + ç§»åŠ¨ | âœ… é«˜ |

---

### 3. Key çš„æœ¬è´¨ï¼šèº«ä»½æ ‡è¯† â­â­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  key å°±åƒå­¦å·                                        â”‚
â”‚                                                     â”‚
â”‚  æ²¡æœ‰å­¦å·ï¼šè€å¸ˆåªèƒ½è¯´ "ç¬¬ä¸€æ’ç¬¬ä¸€ä¸ª"                  â”‚
â”‚           â†’ æ¢åº§ä½åå°±æ‰¾ä¸åˆ°äººäº†                     â”‚
â”‚                                                     â”‚
â”‚  æœ‰å­¦å·ï¼šè€å¸ˆè¯´ "å­¦å· 001 çš„åŒå­¦"                    â”‚
â”‚         â†’ ä¸ç®¡åå“ªé‡Œéƒ½èƒ½æ‰¾åˆ°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**key å‘Šè¯‰ React**ï¼š"è¿™æ˜¯è°"ï¼Œè€Œä¸æ˜¯ "è¿™åœ¨å“ª"ã€‚

---

### 4. index ä½œä¸º key çš„é™·é˜± âš ï¸

ç”¨ index ä½œä¸º key ä¼šå¯¼è‡´**çŠ¶æ€é”™ä¹±**ï¼š

```tsx
// âŒ å±é™©ï¼šç”¨ index ä½œä¸º key
{items.map((item, index) => (
  <li key={index}>
    {item.name}
    <input placeholder="å¤‡æ³¨..." />
  </li>
))}
```

**å®éªŒç»“æœ**ï¼š
1. ç»™ iPhone è¾“å…¥å¤‡æ³¨ "aaa"
2. åœ¨å¼€å¤´æ’å…¥æ–°å•†å“
3. å¤‡æ³¨ "aaa" è·‘åˆ°æ–°å•†å“ä¸Šäº†ï¼

**åŸå› **ï¼š

```
æ·»åŠ å‰: key=0 â†’ iPhone çš„ inputï¼ˆæœ‰ "aaa"ï¼‰
æ·»åŠ å: key=0 â†’ æ–°å•†å“ çš„ input  â† React: "key=0 è¿˜åœ¨ï¼Œå¤ç”¨ DOM"
```

React è®¤ä¸º key=0 çš„ç»„ä»¶"è¿˜æ˜¯åŒä¸€ä¸ª"ï¼Œæ‰€ä»¥å¤ç”¨äº† DOMï¼Œå¯¼è‡´è¾“å…¥æ¡†å†…å®¹é”™ä½ã€‚

---

### 5. Key é€‰æ‹©åŸåˆ™ â­â­

| æ¥æº | ç¤ºä¾‹ | æ˜¯å¦æ¨è |
|------|------|----------|
| **æ•°æ®åº“ ID** | `key={user.id}` | âœ… æœ€ä½³ |
| **ä¸šåŠ¡å”¯ä¸€æ ‡è¯†** | `key={product.sku}` | âœ… æ¨è |
| **å€¼æœ¬èº«ï¼ˆå¦‚æœå”¯ä¸€ï¼‰** | `key={tag}` | âœ… å¯ç”¨ |
| **æ•°ç»„ç´¢å¼•** | `key={index}` | âš ï¸ ä»…ç‰¹å®šåœºæ™¯ |

#### index å®‰å…¨çš„æƒ…å†µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ»¡è¶³ã€æ‰€æœ‰ã€‘æ¡ä»¶æ—¶ï¼Œindex ä½œä¸º key æ˜¯å®‰å…¨çš„ï¼š        â”‚
â”‚                                                     â”‚
â”‚  1. åˆ—è¡¨æ˜¯é™æ€çš„ï¼Œæˆ–åªåœ¨æœ«å°¾è¿½åŠ                      â”‚
â”‚  2. åˆ—è¡¨é¡¹ä¸ä¼šé‡æ–°æ’åº                               â”‚
â”‚  3. åˆ—è¡¨é¡¹ä¸ä¼šä»ä¸­é—´åˆ é™¤                             â”‚
â”‚  4. åˆ—è¡¨é¡¹æ²¡æœ‰å†…éƒ¨çŠ¶æ€ï¼ˆå¦‚ inputã€checkboxï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç”¨å»ºè®®**ï¼šå½“ä½ çŠ¹è±«è¦ä¸è¦ç”¨ index æ—¶ï¼Œç›´æ¥ç”¨ id å°±å¯¹äº†ã€‚

---

### 6. å—æ§ç»„ä»¶ï¼šchecked + onChange â­

åœ¨ç»ƒä¹ ä¸­å­¦åˆ°çš„é¢å¤–çŸ¥è¯†ç‚¹ï¼š

```tsx
<input
  type="checkbox"
  checked={showInStockOnly}                          // çŠ¶æ€ â†’ æ˜¾ç¤º
  onChange={e => setShowInStockOnly(e.target.checked)} // æ“ä½œ â†’ æ›´æ–°çŠ¶æ€
/>
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checked  = ç¯ç°åœ¨æ˜¯å¼€ç€è¿˜æ˜¯å…³ç€ï¼Ÿï¼ˆè¯»å–çŠ¶æ€ï¼‰        â”‚
â”‚  onChange = æœ‰äººæ‹¨åŠ¨äº†å¼€å…³ï¼Œè¦åšä»€ä¹ˆï¼Ÿï¼ˆæ›´æ–°çŠ¶æ€ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµ**ï¼š

```mermaid
flowchart LR
    A["ğŸ‘† ç”¨æˆ·ç‚¹å‡»"] --> B["onChange è§¦å‘"]
    B --> C["e.target.checked"]
    C --> D["setState æ›´æ–°"]
    D --> E["ç»„ä»¶é‡æ–°æ¸²æŸ“"]
    E --> F["checked={state}"]
    F -.-> A

    style A fill:#ffebee,stroke:#c62828
    style D fill:#e8f5e9,stroke:#388e3c
    style F fill:#e3f2fd,stroke:#1976d2
```

è¿™æ˜¯ä¸€ä¸ª**å•å‘æ•°æ®æµå¾ªç¯**ï¼šç”¨æˆ·æ“ä½œ â†’ æ›´æ–°çŠ¶æ€ â†’ é‡æ–°æ¸²æŸ“ â†’ æ˜¾ç¤ºæ–°çŠ¶æ€ã€‚

---

## ğŸ§  æ ¸å¿ƒå¿ƒæ³•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚   åˆ—è¡¨æ¸²æŸ“ = map è¿”å› JSX æ•°ç»„ + key æ ‡è¯†èº«ä»½        â”‚
â”‚                                                     â”‚
â”‚   key çš„æœ¬è´¨ï¼šå‘Šè¯‰ React "è¿™æ˜¯è°"ï¼Œè€Œä¸æ˜¯ "è¿™åœ¨å“ª"   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœï¸ ç»ƒä¹ 

å®Œæˆä»¥ä¸‹ç»ƒä¹ ï¼š

| ç»ƒä¹  | æ–‡ä»¶ | çŸ¥è¯†ç‚¹ |
|------|------|--------|
| key å¯¹æ¯”æ¼”ç¤º | [08-key-index-problem.tsx](idea://open?file=/Users/linqibin/Desktop/Patra/patra-react-playground/src/exercises/ch02/08-key-index-problem.tsx) | index vs id çš„å·®å¼‚ |
| å•†å“ç­›é€‰åˆ—è¡¨ | [08-list-rendering.tsx](idea://open?file=/Users/linqibin/Desktop/Patra/patra-react-playground/src/exercises/ch02/08-list-rendering.tsx) | ç»¼åˆï¼šmap + filter + key + å—æ§ç»„ä»¶ |

---

## ğŸ’¡ å­¦ä¹ åæ€

### æŒæ¡è¾ƒå¥½çš„éƒ¨åˆ†
- é€šè¿‡"å­¦å·"ç±»æ¯”ç†è§£äº† key çš„æœ¬è´¨
- äº²çœ¼çœ‹åˆ°äº† index ä½œä¸º key å¯¼è‡´çš„çŠ¶æ€é”™ä¹±
- ç»¼åˆç»ƒä¹ ä¸­æˆåŠŸè¿ç”¨äº† mapã€filterã€æ¡ä»¶æ¸²æŸ“

### é¢å¤–æ”¶è·
- checkbox çš„å—æ§ç»„ä»¶æ¨¡å¼ï¼ˆchecked + onChangeï¼‰
- ç†è§£äº† `e.target.checked` è·å– checkbox çŠ¶æ€

### å®ç”¨å»ºè®®
- æ•°æ®æœ‰ id æ—¶ï¼Œæ°¸è¿œç”¨ id ä½œä¸º key
- çŠ¹è±«æ—¶é€‰ idï¼Œä¸è¦ç”¨ index

---

## ğŸ”— å¯¼èˆª

- ä¸Šä¸€èŠ‚ï¼š[[07-conditional-rendering|æ¡ä»¶æ¸²æŸ“]]
- ä¸‹ä¸€èŠ‚ï¼š[[09-form-handling|è¡¨å•å¤„ç†]]
